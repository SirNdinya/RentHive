{% extends 'base_generic.html' %}
{% load static %}
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
{% block content %}
  <div class="container">
    <div class="form-container">
      <h2 class="form-heading">Create Your Account</h2>
    {% if messages %}
    <div class="messages">
        {% for message in messages %}
            <div class="message {% if message.tags == 'error' %}error{% else %}success{% endif %}">
                {{ message }}
            </div>
        {% endfor %}
    </div>

    {% if redirect_to_login %}
        <script>
            // Redirect after 3 seconds
            setTimeout(function() {
                window.location.href = "{% url 'login' %}";
            }, 3000);
        </script>
    {% endif %}
{% endif %}

      <form method="post" class="registration-form">
        {% csrf_token %}  {# CSRF token for security #}

        {# Common registration fields (shown for all users) #}
        <div class="form-group">
          <label for="id_username">Username</label>
          {{ form.username }}  {# Django form field rendering #}
        </div>
        <div class="form-group">
          <label for="id_email">Email Address</label>
          {{ form.email }}
        </div>
        <div class="form-group">
          <label for="id_password1">Password</label>
          {{ form.password1 }}
        </div>
        <div class="form-group">
          <label for="id_password2">Confirm Password</label>
          {{ form.password2 }}
        </div>

        {# Role selection dropdown #}
        <div class="form-group">
          <label for="id_role">Role:</label>
          <select name="role" id="roleSelect" class="form-control">
            <option value="">--Select Role--</option>
            {# Preselect option if form was submitted with errors #}
            <option value="TENANT" {% if form.role.value == 'TENANT' %}selected{% endif %}>Tenant</option>
            <option value="PROPERTY_OWNER" {% if form.role.value == 'PROPERTY_OWNER' %}selected{% endif %}>Property Owner</option>
          </select>
        </div>

        {# Tenant-specific fields (hidden by default) #}
        <div id="tenant-fields" class="form-group" style="display: none;">
            <label for="id_university">University:</label>
            <input type="text" name="university" id="id_university"
                   value="{{ form.university.value|default:'' }}" class="form-control" autocomplete="off">
            <div id="suggestions" class="suggestions"></div>
        </div>


        {# Property owner-specific fields (hidden by default) #}
        <div id="property-owner-fields" class="form-group" style="display: none;">

          <label for="id_phone_number">Phone Number:</label>
          <input type="text" name="phone_number" id="id_phone_number"
                 value="{{ form.phone_number.value|default:'' }}" class="form-control">
        </div>

        {# Submit button #}
        <div class="button-container">
            <button type="submit" class="btn btn-primary">Register</button>
        </div>
      </form>

      {# Login link for existing users #}
      <div class="alternative-option">
        <p>Already have an account? <a href="{% url 'login' %}">Login here</a></p>
      </div>
    </div>
  </div>
{% endblock %}

{% block styles %}
  {# Additional page-specific styles #}
  <link rel="stylesheet" type="text/css" href="{% static 'css/styles.css' %}">
{% endblock %}

{% block scripts %}
    <script src="{% static 'js/user_scripts.js' %}"></script>
{% endblock %}
